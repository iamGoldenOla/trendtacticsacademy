-- ==========================================
-- VIBE CODING MODULE 7 - ALL 3 LESSONS
-- Advanced Vibe Coding
-- Compact HTML formatting
-- ==========================================

DO $$
DECLARE
    v_course_id UUID;
    v_module_id UUID;
BEGIN
    SELECT id INTO v_course_id FROM courses WHERE title ILIKE '%Vibe Coding%' LIMIT 1;
    IF v_course_id IS NULL THEN RAISE EXCEPTION 'Vibe Coding course not found'; END IF;
    
    SELECT id INTO v_module_id FROM modules WHERE course_id = v_course_id AND ordering = 7 LIMIT 1;
    IF v_module_id IS NULL THEN RAISE EXCEPTION 'Module 7 not found'; END IF;
    
    RAISE NOTICE 'ðŸ“š Expanding Vibe Coding Module 7 (All 3 Lessons)...';
    
    -- LESSON 22: Verification Prompts
    UPDATE lessons SET content = '<div class="lesson-content"><h2>Verification Prompts</h2><h3>Ensuring Quality and Correctness</h3><p>Verification prompts are a powerful technique for improving the quality of AI-generated code. Instead of just generating and hoping it works, you actively ask AI to verify, test, and validate its own output. This lesson teaches you how to use verification prompts to catch bugs early and build more reliable software.</p><h3>What Are Verification Prompts?</h3><p>Verification prompts ask AI to check its own work: "Does this code handle edge cases?" "Are there any security vulnerabilities?" "Will this work with the existing codebase?" "What could go wrong with this implementation?"</p><p>Think of it as having AI be its own code reviewer.</p><h3>Types of Verification Prompts</h3><h4>1. Correctness Verification</h4><p>Prompt: "Review this function and check: Does it handle all input types correctly? Are there any logical errors? Does it return the expected output? Are there off-by-one errors? Does it match the requirements?"</p><h4>2. Security Verification</h4><p>Prompt: "Analyze this code for security issues: SQL injection vulnerabilities. XSS attack vectors. CSRF protection. Input validation gaps. Authentication bypasses. Data exposure risks."</p><h4>3. Performance Verification</h4><p>Prompt: "Check this code for performance issues: Time complexity (is it O(nÂ²) when it could be O(n)?). Memory leaks. Unnecessary re-renders. N+1 query problems. Missing indexes. Inefficient algorithms."</p><h4>4. Edge Case Verification</h4><p>Prompt: "What edge cases does this code need to handle: Empty inputs. Null/undefined values. Very large numbers. Special characters. Concurrent requests. Network failures."</p><h3>The Verification Workflow</h3><p><strong>Step 1: Generate Code</strong><br>"Create a function to calculate shipping cost based on weight and distance."</p><p><strong>Step 2: Verify Correctness</strong><br>"Review this shipping calculation function. Does it handle: Zero weight? Negative values? Very large distances? Decimal weights? What happens if distance is zero?"</p><p><strong>Step 3: Request Improvements</strong><br>"Add validation and error handling for all the edge cases you identified."</p><p><strong>Step 4: Verify Again</strong><br>"Is the error handling comprehensive? Are the error messages user-friendly?"</p><h3>Specific Verification Techniques</h3><h4>Test Case Generation</h4><p>Prompt: "Generate test cases for this function covering: Normal cases. Boundary values. Invalid inputs. Edge cases. Error conditions. For each test case, specify: Input values, Expected output, Why this case matters."</p><h4>Code Review Simulation</h4><p>Prompt: "Act as a senior developer reviewing this code. Identify: Potential bugs. Code smells. Performance issues. Security concerns. Maintainability problems. Best practice violations."</p><h4>Requirement Verification</h4><p>Prompt: "Compare this implementation against the requirements: [paste requirements]. Does it meet all requirements? Are there any missing features? Are there any deviations? Are there any misunderstandings?"</p><h4>Integration Verification</h4><p>Prompt: "Check if this new code integrates properly with: Existing authentication system. Current database schema. API contracts. Frontend expectations. Third-party services."</p><h3>Domain-Specific Verification</h3><h4>Frontend Verification</h4><p>Prompt: "Verify this React component: Does it handle loading states? Does it handle error states? Is it accessible (ARIA labels, keyboard navigation)? Is it responsive? Does it prevent unnecessary re-renders? Are there any memory leaks (cleanup in useEffect)?"</p><h4>Backend Verification</h4><p>Prompt: "Verify this API endpoint: Does it validate all inputs? Does it handle authentication? Does it implement rate limiting? Does it return appropriate status codes? Does it log errors properly? Is it protected against injection attacks?"</p><h4>Database Verification</h4><p>Prompt: "Verify this database query: Is it optimized (using indexes)? Does it prevent SQL injection? Does it handle large result sets? Does it use transactions where needed? Are there any N+1 query issues?"</p><h3>Automated Verification Prompts</h3><h4>Generate Unit Tests</h4><p>Prompt: "Write unit tests for this function that verify: All happy path scenarios. All error scenarios. All edge cases. Mock external dependencies. Achieve 100% code coverage."</p><h4>Generate Integration Tests</h4><p>Prompt: "Write integration tests that verify: API endpoints work end-to-end. Database operations succeed. Authentication flows correctly. Error handling works. Data persists correctly."</p><h4>Generate E2E Tests</h4><p>Prompt: "Write end-to-end tests using Playwright/Cypress that verify: User can complete the signup flow. User can create and edit content. User can perform critical actions. Error messages display correctly. Loading states work properly."</p><h3>Pre-Deployment Verification</h3><h4>Checklist Verification</h4><p>Prompt: "Before deploying, verify: All tests pass. No console errors or warnings. Performance is acceptable (Lighthouse score >90). Accessibility standards met (WCAG AA). Security headers configured. Environment variables set. Database migrations ready. Rollback plan in place."</p><h4>Breaking Change Detection</h4><p>Prompt: "Analyze these changes for breaking changes: API contract changes. Database schema changes. Function signature changes. Dependency updates. Configuration changes. List all breaking changes and migration steps needed."</p><h3>Continuous Verification</h3><h4>Code Quality Checks</h4><p>Prompt: "Review this codebase for: Code duplication. Inconsistent naming. Missing documentation. Complex functions (>50 lines). Deep nesting (>3 levels). Magic numbers. Commented-out code."</p><h4>Dependency Verification</h4><p>Prompt: "Check dependencies for: Security vulnerabilities. Outdated packages. Unused dependencies. License compatibility. Bundle size impact. Better alternatives."</p><h3>Verification Prompts for Different Phases</h3><h4>Planning Phase</h4><p>Prompt: "Review this technical plan: Are there any architectural issues? Are there scalability concerns? Are there security considerations? Are there better approaches? What are the risks?"</p><h4>Implementation Phase</h4><p>Prompt: "As I build this feature, verify each component: Does it follow project patterns? Is it properly typed (TypeScript)? Is it tested? Is it documented? Does it handle errors?"</p><h4>Review Phase</h4><p>Prompt: "Perform a comprehensive code review: Functionality correctness. Code quality. Performance. Security. Maintainability. Test coverage."</p><h3>Common Verification Patterns</h3><p><strong>The Double-Check Pattern:</strong> Generate code â†’ Ask AI to review it â†’ Fix issues â†’ Verify fixes</p><p><strong>The Test-First Pattern:</strong> Generate tests â†’ Generate code â†’ Verify code passes tests</p><p><strong>The Peer Review Pattern:</strong> Generate code â†’ Ask different AI model to review â†’ Compare feedback</p><h3>Verification Prompt Templates</h3><p><strong>Security Template:</strong> "Analyze [code] for security vulnerabilities including: [list specific concerns]. For each issue found, explain the risk and suggest a fix."</p><p><strong>Performance Template:</strong> "Review [code] for performance issues. Identify: Time complexity, Memory usage, Potential bottlenecks. Suggest optimizations."</p><p><strong>Completeness Template:</strong> "Check if [code] handles: [list scenarios]. For any missing scenarios, explain what should happen and how to implement it."</p><h3>When Verification Finds Issues</h3><p>AI identifies a problem: "This function doesn''t handle null inputs and will throw an error."</p><p>Your response: "Add null checking with appropriate error handling. Return a clear error message if input is null."</p><p>Verify the fix: "Does this null checking cover all cases? Are there other falsy values to consider (undefined, empty string)?"</p><h3>Limitations of AI Verification</h3><p>AI verification isn''t perfect: May miss subtle bugs. Can''t test actual runtime behavior. Doesn''t replace human code review. Can''t verify business logic correctness without context. May suggest over-engineering.</p><p>Use verification prompts as one layer of quality assurance, not the only layer.</p><h3>Best Practices</h3><p>1. Verify early and often (don''t wait until the end). 2. Be specific about what to verify. 3. Provide context about your system. 4. Actually implement suggested fixes. 5. Re-verify after making changes. 6. Combine AI verification with automated tests. 7. Still do manual code review for critical code.</p><h3>Key Takeaways</h3><ul><li>Verification prompts ask AI to <strong>check its own work</strong></li><li>Verify for: <strong>correctness, security, performance, edge cases</strong></li><li>Use verification at <strong>all phases</strong>: planning, implementation, review</li><li>Generate <strong>automated tests</strong> as part of verification</li><li>Create <strong>verification checklists</strong> for consistency</li><li>Verification <strong>isn''t perfect</strong>â€”combine with testing and human review</li><li>Verify <strong>early and often</strong> to catch issues before they compound</li></ul><p>In the next lesson, we''ll explore cost, performance, and sanityâ€”keeping your Vibe Coding sustainable.</p></div>'
    WHERE module_id = v_module_id AND ordering = 1;
    RAISE NOTICE 'âœ… Lesson 22 Complete';
    
    RAISE NOTICE 'ðŸŽ‰ Module 7 Lesson 1/3 Complete!';
    
END $$;
