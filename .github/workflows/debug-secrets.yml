name: Debug GitHub Secrets

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  debug-secrets:
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Checkout repo
      - name: Checkout repository
        uses: actions/checkout@v4

      # Step 2: Debug secrets
      - name: Debug secrets (safe)
        run: |
          echo "üîç Debugging GitHub Secrets..."
          
          # Check if secrets are set (without revealing their values)
          if [ -z "${{ secrets.FTP_HOST }}" ]; then
            echo "‚ùå FTP_HOST is NOT set"
          else
            echo "‚úÖ FTP_HOST is set"
          fi
          
          if [ -z "${{ secrets.FTP_USERNAME }}" ]; then
            echo "‚ùå FTP_USERNAME is NOT set"
          else
            echo "‚úÖ FTP_USERNAME is set"
          fi
          
          if [ -z "${{ secrets.FTP_PASSWORD }}" ]; then
            echo "‚ùå FTP_PASSWORD is NOT set"
          else
            echo "‚úÖ FTP_PASSWORD is set (hidden)"
          fi
          
          if [ -z "${{ secrets.SUPABASE_URL }}" ]; then
            echo "‚ùå SUPABASE_URL is NOT set"
          else
            echo "‚úÖ SUPABASE_URL is set"
          fi
          
          if [ -z "${{ secrets.SUPABASE_ANON_KEY }}" ]; then
            echo "‚ùå SUPABASE_ANON_KEY is NOT set"
          else
            echo "‚úÖ SUPABASE_ANON_KEY is set (hidden)"
          fi
          
          echo ""
          echo "üìù Environment variables:"
          echo "FTP_HOST: ${FTP_HOST}"
          echo "FTP_USERNAME: ${FTP_USERNAME}"
          
          # Additional debugging - check if any secrets are actually accessible
          echo ""
          echo "üîß Detailed Secret Debugging:"
          echo "========================="
          
          # We can't print the actual secret values, but we can check their length
          if [ ! -z "${{ secrets.FTP_HOST }}" ]; then
            echo "FTP_HOST length: $(echo -n "${{ secrets.FTP_HOST }}" | wc -c) characters"
          fi
          
          if [ ! -z "${{ secrets.FTP_USERNAME }}" ]; then
            echo "FTP_USERNAME length: $(echo -n "${{ secrets.FTP_USERNAME }}" | wc -c) characters"
          fi

      # Step 3: Simple echo test
      - name: Echo test
        run: |
          echo "‚úÖ Debug workflow completed successfully"
          echo "üìã Next steps:"
          echo "1. Check the output above to see which secrets are missing"
          echo "2. Go to GitHub Settings ‚Üí Secrets and Variables ‚Üí Actions"
          echo "3. Add any missing secrets with EXACT names:"
          echo "   - FTP_HOST"
          echo "   - FTP_USERNAME" 
          echo "   - FTP_PASSWORD"
          echo "   - SUPABASE_URL"
          echo "   - SUPABASE_ANON_KEY"